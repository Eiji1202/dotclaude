"use server";

import type { createCertificateSchema } from "@/app/certificate/schema";
import { convertImageUrl } from "@/lib/image";
import { prisma } from "@/lib/prisma";
import type { z } from "zod";

export async function getCertificateList() {
  return prisma.certificate.findMany({ orderBy: { id: "desc" } });
}

export async function upsertCertificate(
  data: z.infer<typeof createCertificateSchema>,
) {
  const id = Number(data.id);

  await prisma.certificate.upsert({
    where: { id },
    update: {
      id,
      imageURL: convertImageUrl(data.imageURL),
      updatedAt: new Date(),
    },
    create: {
      id,
      imageURL: convertImageUrl(data.imageURL),
      tenantId: "default-tenant",
    },
  });
}
